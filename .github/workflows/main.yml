name: Process Template Files

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  process:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
      - uses: actions/checkout@v3

      - name: Show working directory
        run: ls -l

      - name: Process Numbers.txt
        id: numbers
        run: |
          if [[ ! -f "Numbers.txt" ]]; then
            echo "Error: Numbers.txt not found!"
            exit 1
          fi

          # Extract numbers and calculate the sum
          numbers=$(grep -oE '[0-9]+' Numbers.txt)
          sum=0
          for n in $numbers; do
            sum=$((sum + n))
          done

          echo "SUM=$sum" >> $GITHUB_ENV
          echo "Calculated sum: $sum"

      - name: Process name.txt
        id: namefile
        run: |
          if [[ ! -f "name.txt" ]]; then
            echo "Error: name.txt not found!"
            exit 1
          fi

          NAME=$(cat name.txt)
          echo "USERNAME=$NAME" >> $GITHUB_ENV
          echo "Read name: $NAME"

      - name: Create output files with replaced placeholders
        run: |
          mkdir output
          
          # Replace {{sum}} in Numbers.txt
          sed "s/{{sum}}/$SUM/" Numbers.txt > output/Numbers_processed.txt

          # Replace {{name}} in name.txt
          sed "s/{{name}}/$USERNAME/" name.txt > output/name_processed.txt

          echo "Generated processed files:"
          ls -l output/

      - name: Upload processed files as artifacts
        uses: actions/upload-artifact@v3
        with:
          name: processed-files
          path: output/
